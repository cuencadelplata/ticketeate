generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Usuario {
  usuarioid       String      @id @db.VarChar(255)
  nombre          String      @db.VarChar(100)
  apellido        String      @db.VarChar(100)
  email           String      @unique @db.VarChar(150)
  telefono        String?     @db.VarChar(20)
  fecha_registro  DateTime    @default(now()) @db.Timestamptz(6)
  estado          String      @default("activo") @db.VarChar(20)
  wallet_linked   Boolean     @default(false)
  wallet_provider String?     @db.VarChar(50)
  rol             String?     @default("cliente")
  cola_turnos     ColaTurno[]
  eventos         Evento[]
  logs_eventos    LogEvento[]
  reservas        Reserva[]
  sesiones        Sesion[]

  @@map("usuarios")
}

model Evento {
  eventoid           String             @id @db.VarChar(255)
  titulo             String             @db.VarChar(200)
  descripcion        String?
  ubicacion          String?            @db.VarChar(255)
  fecha_creacion     DateTime           @default(now()) @db.Timestamptz(6)
  fecha_inicio_venta DateTime           @db.Timestamptz(6)
  fecha_fin_venta    DateTime           @db.Timestamptz(6)
  creadorid          String             @db.VarChar(255)
  estado             String             @default("OCULTO") @db.VarChar(20)
  mapa_evento        Json?
  categoriaentrada   categoriaentrada[]
  categorias_entrada CategoriaEntrada[]
  catevento          catevento[]
  colas_evento       ColaEvento[]
  estadisticas       Estadistica[]
  usuarios           Usuario            @relation(fields: [creadorid], references: [usuarioid], onDelete: Cascade)
  fechas_evento      FechaEvento[]
  imagenes_evento    ImagenEvento[]
  logs_eventos       LogEvento[]
  reservas           Reserva[]

  @@map("eventos")
}

model FechaEvento {
  fechaid    String    @id @db.VarChar(255)
  eventoid   String    @db.VarChar(255)
  fecha_hora DateTime  @db.Timestamptz(6)
  fecha_fin  DateTime? @db.Timestamptz(6)
  eventos    Evento    @relation(fields: [eventoid], references: [eventoid], onDelete: Cascade)
  reservas   Reserva[]

  @@map("fechas_evento")
}

model ImagenEvento {
  imagenid String @id @db.VarChar(255)
  eventoid String @db.VarChar(255)
  url      String @db.VarChar(500)
  tipo     String @default("GALERIA") @db.VarChar(20)
  eventos  Evento @relation(fields: [eventoid], references: [eventoid], onDelete: Cascade)

  @@map("imagenes_evento")
}

model CategoriaEntrada {
  categoriaid      String    @id @db.VarChar(255)
  eventoid         String    @db.VarChar(255)
  nombre           String    @db.VarChar(100)
  descripcion      String?
  precio           Decimal   @db.Decimal(10, 2)
  stock_total      Int
  stock_disponible Int
  max_por_usuario  Int       @default(4)
  eventos          Evento    @relation(fields: [eventoid], references: [eventoid], onDelete: Cascade)
  reservas         Reserva[]

  @@map("categorias_entrada")
}

model Reserva {
  reservaid          String           @id @db.VarChar(255)
  usuarioid          String           @db.VarChar(255)
  eventoid           String           @db.VarChar(255)
  fechaid            String           @db.VarChar(255)
  categoriaid        String           @db.VarChar(255)
  cantidad           Int
  fecha_reserva      DateTime         @default(now()) @db.Timestamptz(6)
  estado             String           @default("PENDIENTE") @db.VarChar(20)
  entradas           Entrada[]
  pagos              Pago[]
  categorias_entrada CategoriaEntrada @relation(fields: [categoriaid], references: [categoriaid], onDelete: Cascade)
  eventos            Evento           @relation(fields: [eventoid], references: [eventoid], onDelete: Cascade)
  fechas_evento      FechaEvento      @relation(fields: [fechaid], references: [fechaid], onDelete: Cascade)
  usuarios           Usuario          @relation(fields: [usuarioid], references: [usuarioid], onDelete: Cascade)

  @@map("reservas")
}

model Entrada {
  entradaid String  @id @db.VarChar(255)
  reservaid String  @db.VarChar(255)
  codigo_qr String  @unique @db.VarChar(255)
  estado    String  @default("VALIDA") @db.VarChar(20)
  reservas  Reserva @relation(fields: [reservaid], references: [reservaid], onDelete: Cascade)

  @@map("entradas")
}

model Pago {
  pagoid      String    @id @db.VarChar(255)
  reservaid   String    @db.VarChar(255)
  metodo_pago String    @db.VarChar(50)
  monto_total Decimal   @db.Decimal(10, 2)
  fecha_pago  DateTime? @default(now()) @db.Timestamptz(6)
  estado      String    @default("PENDIENTE") @db.VarChar(20)
  reservas    Reserva   @relation(fields: [reservaid], references: [reservaid], onDelete: Cascade)

  @@map("pagos")
}

model ColaEvento {
  colaid           String      @id @db.VarChar(255)
  eventoid         String      @db.VarChar(255)
  max_concurrentes Int
  max_usuarios     Int
  fecha_creacion   DateTime    @default(now()) @db.Timestamptz(6)
  cola_turnos      ColaTurno[]
  eventos          Evento      @relation(fields: [eventoid], references: [eventoid], onDelete: Cascade)

  @@map("colas_evento")
}

model ColaTurno {
  turnoid        String     @id @db.VarChar(255)
  colaid         String     @db.VarChar(255)
  usuarioid      String     @db.VarChar(255)
  estado         String     @default("esperando") @db.VarChar(20)
  posicion       Int
  fecha_ingreso  DateTime   @default(now()) @db.Timestamptz(6)
  fecha_atencion DateTime?  @db.Timestamptz(6)
  colas_evento   ColaEvento @relation(fields: [colaid], references: [colaid], onDelete: Cascade)
  usuarios       Usuario    @relation(fields: [usuarioid], references: [usuarioid], onDelete: Cascade)

  @@map("cola_turnos")
}

model Estadistica {
  estadisticaid        String   @id @db.VarChar(255)
  eventoid             String   @db.VarChar(255)
  total_vendidos       Int      @default(0)
  total_cancelados     Int      @default(0)
  total_ingresos       Decimal  @default(0) @db.Decimal(12, 2)
  ultima_actualizacion DateTime @default(now()) @db.Timestamptz(6)
  eventos              Evento   @relation(fields: [eventoid], references: [eventoid], onDelete: Cascade)

  @@map("estadisticas")
}

model LogEvento {
  logid     String   @id @db.VarChar(255)
  eventoid  String   @db.VarChar(255)
  usuarioid String?  @db.VarChar(255)
  accion    String   @db.VarChar(100)
  detalle   String?
  fecha     DateTime @default(now()) @db.Timestamptz(6)
  eventos   Evento   @relation(fields: [eventoid], references: [eventoid], onDelete: Cascade)
  usuarios  Usuario? @relation(fields: [usuarioid], references: [usuarioid])

  @@map("logs_eventos")
}

model Sesion {
  sesionid         String   @id @db.VarChar(255)
  usuarioid        String   @db.VarChar(255)
  token            String   @unique @db.VarChar(255)
  fecha_inicio     DateTime @default(now()) @db.Timestamptz(6)
  fecha_expiracion DateTime @db.Timestamptz(6)
  usuarios         Usuario  @relation(fields: [usuarioid], references: [usuarioid], onDelete: Cascade)

  @@map("sesiones")
}

model categoriaentrada {
  categoriaentradaid BigInt  @id @default(autoincrement())
  eventoid           String  @db.VarChar
  nombre             String  @db.VarChar(100)
  precio             Decimal @db.Decimal(10, 2)
  stock_total        Int
  stock_disponible   Int
  max_por_usuario    Int?    @default(4)
  eventos            Evento  @relation(fields: [eventoid], references: [eventoid], onDelete: Cascade, onUpdate: NoAction)
}

model categoriaevento {
  categoriaeventoid BigInt      @id @default(autoincrement())
  nombre            String      @unique @db.VarChar(100)
  descripcion       String?
  catevento         catevento[]
}

model catevento {
  eventoid          String          @db.VarChar
  categoriaeventoid BigInt
  categoriaevento   categoriaevento @relation(fields: [categoriaeventoid], references: [categoriaeventoid], onDelete: Cascade, onUpdate: NoAction)
  eventos           Evento          @relation(fields: [eventoid], references: [eventoid], onDelete: Cascade, onUpdate: NoAction)

  @@id([eventoid, categoriaeventoid])
}

enum EventoEstado {
  ACTIVO
  CANCELADO
  COMPLETADO
  OCULTO
}

enum EstadoReserva {
  PENDIENTE
  CONFIRMADA
  CANCELADA
}

enum TipoImagen {
  PORTADA
  GALERIA
}

enum EstadoPago {
  PENDIENTE
  COMPLETADO
  CANCELADO
  REEMBOLSADO
}

enum EstadoEntrada {
  VALIDA
  USADA
  CANCELADA
}
