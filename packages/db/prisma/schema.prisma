generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model account {
  id                    String    @id
  accountId             String
  providerId            String
  userId                String
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime
  user                  user      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([providerId, accountId])
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model categoriaentrada {
  categoriaentradaid BigInt  @id @default(autoincrement())
  eventoid           String  @db.VarChar
  nombre             String  @db.VarChar(100)
  precio             Decimal @db.Decimal(10, 2)
  stock_total        Int
  stock_disponible   Int
  max_por_usuario    Int?    @default(4)
  eventos            eventos @relation(fields: [eventoid], references: [eventoid], onDelete: Cascade, onUpdate: NoAction)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model categoriaevento {
  categoriaeventoid BigInt      @id @default(autoincrement())
  nombre            String      @unique @db.VarChar(100)
  descripcion       String?
  catevento         catevento[]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model categorias_entrada {
  categoriaid      String     @id @db.VarChar(255)
  eventoid         String     @db.VarChar(255)
  nombre           String     @db.VarChar(100)
  descripcion      String?
  precio           Decimal    @db.Decimal(10, 2)
  stock_total      Int
  stock_disponible Int
  max_por_usuario  Int        @default(4)
  eventos          eventos    @relation(fields: [eventoid], references: [eventoid], onDelete: Cascade)
  reservas         reservas[]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model catevento {
  eventoid          String          @db.VarChar
  categoriaeventoid BigInt
  categoriaevento   categoriaevento @relation(fields: [categoriaeventoid], references: [categoriaeventoid], onDelete: Cascade, onUpdate: NoAction)
  eventos           eventos         @relation(fields: [eventoid], references: [eventoid], onDelete: Cascade, onUpdate: NoAction)

  @@id([eventoid, categoriaeventoid])
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model cola_turnos {
  turnoid        String       @id @db.VarChar(255)
  colaid         String       @db.VarChar(255)
  usuarioid      String       @db.VarChar(255)
  estado         String       @default("esperando") @db.VarChar(20)
  posicion       Int
  fecha_ingreso  DateTime     @default(now()) @db.Timestamptz(6)
  fecha_atencion DateTime?    @db.Timestamptz(6)
  colas_evento   colas_evento @relation(fields: [colaid], references: [colaid], onDelete: Cascade)
  usuarios       usuarios     @relation(fields: [usuarioid], references: [usuarioid], onDelete: Cascade)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model colas_evento {
  colaid           String        @id @db.VarChar(255)
  eventoid         String        @db.VarChar(255)
  max_concurrentes Int
  max_usuarios     Int
  fecha_creacion   DateTime      @default(now()) @db.Timestamptz(6)
  cola_turnos      cola_turnos[]
  eventos          eventos       @relation(fields: [eventoid], references: [eventoid], onDelete: Cascade)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model entradas {
  entradaid String   @id @db.VarChar(255)
  reservaid String   @db.VarChar(255)
  codigo_qr String   @unique @db.VarChar(255)
  estado    String   @default("VALIDA") @db.VarChar(20)
  reservas  reservas @relation(fields: [reservaid], references: [reservaid], onDelete: Cascade)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model estadisticas {
  estadisticaid        String   @id @db.VarChar(255)
  eventoid             String   @db.VarChar(255)
  total_vendidos       Int      @default(0)
  total_cancelados     Int      @default(0)
  total_ingresos       Decimal  @default(0) @db.Decimal(12, 2)
  ultima_actualizacion DateTime @default(now()) @db.Timestamptz(6)
  eventos              eventos  @relation(fields: [eventoid], references: [eventoid], onDelete: Cascade)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model eventos {
  eventoid           String               @id @db.VarChar(255)
  titulo             String               @db.VarChar(200)
  descripcion        String?
  ubicacion          String?              @db.VarChar(255)
  fecha_creacion     DateTime             @default(now()) @db.Timestamptz(6)
  creadorid          String               @db.VarChar(255)
  mapa_evento        Json?
  estado             String               @default("OCULTO") @db.VarChar(20)
  fecha_fin_venta    DateTime             @default(now()) @db.Timestamptz(6)
  fecha_inicio_venta DateTime             @default(now()) @db.Timestamptz(6)
  categoriaentrada   categoriaentrada[]
  categorias_entrada categorias_entrada[]
  catevento          catevento[]
  colas_evento       colas_evento[]
  estadisticas       estadisticas[]
  usuarios           usuarios             @relation(fields: [creadorid], references: [usuarioid], onDelete: Cascade)
  fechas_evento      fechas_evento[]
  imagenes_evento    imagenes_evento[]
  logs_eventos       logs_eventos[]
  reservas           reservas[]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model fechas_evento {
  fechaid    String     @id @db.VarChar(255)
  eventoid   String     @db.VarChar(255)
  fecha_hora DateTime   @db.Timestamptz(6)
  fecha_fin  DateTime?  @db.Timestamptz(6)
  eventos    eventos    @relation(fields: [eventoid], references: [eventoid], onDelete: Cascade)
  reservas   reservas[]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model imagenes_evento {
  imagenid String  @id @db.VarChar(255)
  eventoid String  @db.VarChar(255)
  url      String  @db.VarChar(500)
  tipo     String  @default("GALERIA") @db.VarChar(20)
  eventos  eventos @relation(fields: [eventoid], references: [eventoid], onDelete: Cascade)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model logs_eventos {
  logid     String    @id @db.VarChar(255)
  eventoid  String    @db.VarChar(255)
  usuarioid String?   @db.VarChar(255)
  accion    String    @db.VarChar(100)
  detalle   String?
  fecha     DateTime  @default(now()) @db.Timestamptz(6)
  eventos   eventos   @relation(fields: [eventoid], references: [eventoid], onDelete: Cascade)
  usuarios  usuarios? @relation(fields: [usuarioid], references: [usuarioid])
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model pagos {
  pagoid      String    @id @db.VarChar(255)
  reservaid   String    @db.VarChar(255)
  metodo_pago String    @db.VarChar(50)
  monto_total Decimal   @db.Decimal(10, 2)
  fecha_pago  DateTime? @default(now()) @db.Timestamptz(6)
  estado      String    @default("PENDIENTE") @db.VarChar(20)
  reservas    reservas  @relation(fields: [reservaid], references: [reservaid], onDelete: Cascade)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model reservas {
  reservaid          String             @id @db.VarChar(255)
  usuarioid          String             @db.VarChar(255)
  eventoid           String             @db.VarChar(255)
  fechaid            String             @db.VarChar(255)
  categoriaid        String             @db.VarChar(255)
  cantidad           Int
  fecha_reserva      DateTime           @default(now()) @db.Timestamptz(6)
  estado             String             @default("PENDIENTE") @db.VarChar(20)
  entradas           entradas[]
  pagos              pagos[]
  categorias_entrada categorias_entrada @relation(fields: [categoriaid], references: [categoriaid], onDelete: Cascade)
  eventos            eventos            @relation(fields: [eventoid], references: [eventoid], onDelete: Cascade)
  fechas_evento      fechas_evento      @relation(fields: [fechaid], references: [fechaid], onDelete: Cascade)
  usuarios           usuarios           @relation(fields: [usuarioid], references: [usuarioid], onDelete: Cascade)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model sesiones {
  sesionid         String   @id @db.VarChar(255)
  usuarioid        String   @db.VarChar(255)
  token            String   @unique @db.VarChar(255)
  fecha_inicio     DateTime @default(now()) @db.Timestamptz(6)
  fecha_expiracion DateTime @db.Timestamptz(6)
  usuarios         usuarios @relation(fields: [usuarioid], references: [usuarioid], onDelete: Cascade)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model session {
  id        String   @id
  expiresAt DateTime
  token     String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime
  ipAddress String?
  userAgent String?
  userId    String
  user      user     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model user {
  id            String    @id
  name          String
  email         String    @unique
  emailVerified Boolean
  image         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime
  account       account[]
  session       session[]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model usuarios {
  usuarioid       String         @id @db.VarChar(255)
  nombre          String         @db.VarChar(100)
  apellido        String         @db.VarChar(100)
  email           String         @unique @db.VarChar(150)
  telefono        String?        @db.VarChar(20)
  fecha_registro  DateTime       @default(now()) @db.Timestamptz(6)
  estado          String         @default("activo") @db.VarChar(20)
  wallet_linked   Boolean        @default(false)
  wallet_provider String?        @db.VarChar(50)
  rol             String?        @default("cliente")
  cola_turnos     cola_turnos[]
  eventos         eventos[]
  logs_eventos    logs_eventos[]
  reservas        reservas[]
  sesiones        sesiones[]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model verification {
  id         String   @id
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime
}

enum EstadoEntrada {
  VALIDA
  USADA
  CANCELADA
}

enum EstadoPago {
  PENDIENTE
  COMPLETADO
  CANCELADO
  REEMBOLSADO
}

enum EstadoReserva {
  PENDIENTE
  CONFIRMADA
  CANCELADA
}

enum EventoEstado {
  ACTIVO
  CANCELADO
  COMPLETADO
  OCULTO
}

enum TipoImagen {
  PORTADA
  GALERIA
}
