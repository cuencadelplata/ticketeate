generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model categoriaevento {
  categoriaeventoid Int                 @id @default(autoincrement())
  nombre            String              @unique @db.VarChar(100)
  descripcion       String?
  eventos           evento_categorias[]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model cola_turnos {
  turnoid        String       @id @db.VarChar(255)
  colaid         String       @db.VarChar(255)
  usuarioid      String       @db.VarChar(255)
  estado         String       @default("esperando") @db.VarChar(20)
  posicion       Int
  fecha_ingreso  DateTime     @default(now()) @db.Timestamptz(6)
  fecha_atencion DateTime?    @db.Timestamptz(6)
  colas_evento   colas_evento @relation(fields: [colaid], references: [colaid], onDelete: Cascade)
  user           user         @relation(fields: [usuarioid], references: [id], onDelete: Cascade)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model colas_evento {
  colaid           String        @id @db.VarChar(255)
  eventoid         String        @db.VarChar(255)
  max_concurrentes Int
  max_usuarios     Int
  fecha_creacion   DateTime      @default(now()) @db.Timestamptz(6)
  cola_turnos      cola_turnos[]
  eventos          eventos       @relation(fields: [eventoid], references: [eventoid], onDelete: Cascade)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model entradas {
  entradaid String   @id @db.VarChar(255)
  reservaid String   @db.VarChar(255)
  codigo_qr String   @unique @db.VarChar(255)
  estado    String   @default("VALIDA") @db.VarChar(20)
  reservas  reservas @relation(fields: [reservaid], references: [reservaid], onDelete: Cascade)

  @@index([reservaid], map: "idx_entradas_reservaid")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model estadisticas {
  estadisticaid        String   @id @db.VarChar(255)
  eventoid             String   @db.VarChar(255)
  total_vendidos       Int      @default(0)
  total_cancelados     Int      @default(0)
  total_ingresos       Decimal  @default(0) @db.Decimal(12, 2)
  ultima_actualizacion DateTime @default(now()) @db.Timestamptz(6)
  eventos              eventos  @relation(fields: [eventoid], references: [eventoid], onDelete: Cascade)
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model evento_estado {
  stateventid     String   @id @db.VarChar
  eventoid        String   @db.VarChar
  Estado          String   @default("Oculto") @db.VarChar
  fecha_de_cambio DateTime @default(now()) @db.Timestamptz(6)
  usuarioid       String   @db.VarChar
  eventos         eventos  @relation(fields: [eventoid], references: [eventoid], onDelete: Cascade)
  user            user     @relation(fields: [usuarioid], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([eventoid, fecha_de_cambio(sort: Desc)], map: "idx_evento_estado_eventoid_fecha")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model eventos {
  eventoid          String              @id @db.VarChar(255)
  titulo            String              @db.VarChar(200)
  descripcion       String?
  ubicacion         String              @db.VarChar(255)
  fecha_creacion    DateTime            @default(now()) @db.Timestamptz(6)
  fecha_publicacion  DateTime?           @db.Timestamptz(6)
  creadorid         String              @db.VarChar(255)
  mapa_evento       Json
  fecha_cambio      DateTime            @default(now()) @db.Timestamptz(6)
  colas_evento      colas_evento[]
  estadisticas      estadisticas[]
  evento_categorias evento_categorias[]
  evento_estado     evento_estado[]
  user              user                @relation(fields: [creadorid], references: [id], onDelete: Cascade)
  fechas_evento     fechas_evento[]
  historial_compras historial_compras[]
  imagenes_evento   imagenes_evento[]
  logs_eventos      logs_eventos[]
  reservas          reservas[]
  stock_entrada     stock_entrada[]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model evento_categorias {
  eventoid          String          @db.VarChar(255)
  categoriaeventoid Int
  categoriaevento   categoriaevento @relation(fields: [categoriaeventoid], references: [categoriaeventoid], onDelete: Cascade)
  eventos           eventos         @relation(fields: [eventoid], references: [eventoid], onDelete: Cascade)

  @@id([eventoid, categoriaeventoid])
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model fechas_evento {
  fechaid    String     @id @db.VarChar(255)
  eventoid   String     @db.VarChar(255)
  fecha_hora DateTime   @db.Timestamptz(6)
  fecha_fin  DateTime?  @db.Timestamptz(6)
  eventos    eventos    @relation(fields: [eventoid], references: [eventoid], onDelete: Cascade)
  reservas   reservas[]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model imagenes_evento {
  imagenid String  @id @db.VarChar(255)
  eventoid String  @db.VarChar(255)
  url      String  @db.VarChar(500)
  tipo     String  @default("GALERIA") @db.VarChar(20)
  eventos  eventos @relation(fields: [eventoid], references: [eventoid], onDelete: Cascade)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model logs_eventos {
  logid     String   @id @db.VarChar(255)
  eventoid  String   @db.VarChar(255)
  usuarioid String?  @db.VarChar(255)
  accion    String   @db.VarChar(100)
  detalle   String?
  fecha     DateTime @default(now()) @db.Timestamptz(6)
  eventos   eventos  @relation(fields: [eventoid], references: [eventoid], onDelete: Cascade)
  user      user?    @relation(fields: [usuarioid], references: [id])
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model movimientos_entradas {
  movimientoid  String        @id @db.VarChar
  stockid       String        @db.VarChar
  usuarioid     String        @db.VarChar
  cantidad      Int
  tipo          String        @db.VarChar
  fecha_mov     DateTime      @default(now()) @db.Timestamptz(6)
  stock_entrada stock_entrada @relation(fields: [stockid], references: [stockid], onDelete: NoAction, onUpdate: NoAction)
  user          user          @relation(fields: [usuarioid], references: [id], onDelete: Cascade)

  @@index([stockid, fecha_mov(sort: Desc)], map: "idx_movimientos_stockid_fecha")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model pagos {
  pagoid      String    @id @db.VarChar(255)
  reservaid   String    @db.VarChar(255)
  metodo_pago String    @db.VarChar(50)
  monto_total Decimal   @db.Decimal(10, 2)
  fecha_pago  DateTime? @default(now()) @db.Timestamptz(6)
  estado      String    @default("PENDIENTE") @db.VarChar(20)
  moneda      String    @default("ARS") @db.VarChar(3)
  tasa_cambio Decimal?  @db.Decimal(12, 6)
  reservas    reservas  @relation(fields: [reservaid], references: [reservaid], onDelete: Cascade)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model reservas {
  reservaid         String              @id @db.VarChar(255)
  usuarioid         String              @db.VarChar(255)
  eventoid          String              @db.VarChar(255)
  fechaid           String              @db.VarChar(255)
  categoriaid       String              @db.VarChar(255)
  cantidad          Int
  fecha_reserva     DateTime            @default(now()) @db.Timestamptz(6)
  estado            String              @default("PENDIENTE") @db.VarChar(20)
  entradas          entradas[]
  historial_compras historial_compras[]
  pagos             pagos[]
  stock_entrada     stock_entrada       @relation(fields: [categoriaid], references: [stockid], onDelete: Cascade)
  eventos           eventos             @relation(fields: [eventoid], references: [eventoid], onDelete: Cascade)
  fechas_evento     fechas_evento       @relation(fields: [fechaid], references: [fechaid], onDelete: Cascade)
  user              user                @relation(fields: [usuarioid], references: [id], onDelete: Cascade)

  @@index([usuarioid, eventoid], map: "idx_reservas_usuario_evento")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model sesiones {
  sesionid         String   @id @db.VarChar(255)
  usuarioid        String   @db.VarChar(255)
  token            String   @unique @db.VarChar(255)
  fecha_inicio     DateTime @default(now()) @db.Timestamptz(6)
  fecha_expiracion DateTime @db.Timestamptz(6)
  user             user     @relation(fields: [usuarioid], references: [id], onDelete: Cascade)
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model stock_entrada {
  stockid              String                 @id @db.VarChar
  eventoid             String                 @db.VarChar
  nombre               String                 @db.VarChar
  precio               BigInt
  cant_max             Int
  fecha_creacion       DateTime               @default(now()) @db.Timestamptz(6)
  fecha_limite         DateTime               @default(dbgenerated("(now() + '1 year'::interval)")) @db.Timestamptz(6)
  moneda               String                 @default("ARS") @db.VarChar(3)
  movimientos_entradas movimientos_entradas[]
  reservas             reservas[]
  eventos              eventos                @relation(fields: [eventoid], references: [eventoid], onDelete: Cascade)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model account {
  id                    String    @id
  accountId             String
  providerId            String
  userId                String
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime
  user                  user      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([providerId, accountId])
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model session {
  id        String   @id
  expiresAt DateTime
  token     String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime
  ipAddress String?
  userAgent String?
  userId    String
  user      user     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model user {
  id                   String                 @id
  name                 String
  email                String                 @unique
  emailVerified        Boolean
  image                String?
  role                 Role                   @default(USUARIO)
  createdAt            DateTime               @default(now())
  updatedAt            DateTime
  account              account[]
  cola_turnos          cola_turnos[]
  evento_estado        evento_estado[]
  eventos              eventos[]
  historial_compras    historial_compras[]
  logs_eventos         logs_eventos[]
  movimientos_entradas movimientos_entradas[]
  reservas             reservas[]
  sesiones             sesiones[]
  session              session[]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model jwks {
  id         String   @id
  publicKey  String
  privateKey String
  createdAt  DateTime @default(now())
}

model historial_compras {
  id              String   @id @db.VarChar(255)
  usuarioid       String   @db.VarChar(255)
  reservaid       String   @db.VarChar(255)
  eventoid        String   @db.VarChar(255)
  cantidad        Int
  monto_total     Decimal  @db.Decimal(10, 2)
  moneda          String   @db.VarChar(3)
  estado_compra   String   @db.VarChar(20)
  fecha_compra    DateTime @default(now()) @db.Timestamptz(6)
  fecha_evento    DateTime @db.Timestamptz(6)
  comprobante_url String?  @db.VarChar(500)
  eventos         eventos  @relation(fields: [eventoid], references: [eventoid], onDelete: Cascade)
  reservas        reservas @relation(fields: [reservaid], references: [reservaid], onDelete: Cascade)
  user            user     @relation(fields: [usuarioid], references: [id], onDelete: Cascade)

  @@index([eventoid, fecha_compra])
  @@index([usuarioid, fecha_compra])
}

model monedas {
  codigo                                            String         @id @db.VarChar(3)
  nombre                                            String         @db.VarChar(50)
  simbolo                                           String         @db.VarChar(5)
  activa                                            Boolean        @default(true)
  fecha_creacion                                    DateTime       @default(now()) @db.Timestamptz(6)
  tasas_cambio_tasas_cambio_moneda_destinoTomonedas tasas_cambio[] @relation("tasas_cambio_moneda_destinoTomonedas")
  tasas_cambio_tasas_cambio_moneda_origenTomonedas  tasas_cambio[] @relation("tasas_cambio_moneda_origenTomonedas")
}

model tasas_cambio {
  id                                           String   @id @db.VarChar(255)
  moneda_origen                                String   @db.VarChar(3)
  moneda_destino                               String   @db.VarChar(3)
  tasa                                         Decimal  @db.Decimal(12, 6)
  fecha_actualizacion                          DateTime @default(now()) @db.Timestamptz(6)
  activa                                       Boolean  @default(true)
  monedas_tasas_cambio_moneda_destinoTomonedas monedas  @relation("tasas_cambio_moneda_destinoTomonedas", fields: [moneda_destino], references: [codigo], onDelete: Cascade)
  monedas_tasas_cambio_moneda_origenTomonedas  monedas  @relation("tasas_cambio_moneda_origenTomonedas", fields: [moneda_origen], references: [codigo], onDelete: Cascade)

  @@unique([moneda_origen, moneda_destino])
  @@index([moneda_origen, moneda_destino, fecha_actualizacion])
}

enum EstadoEntrada {
  VALIDA
  USADA
  CANCELADA
}

enum EstadoPago {
  PENDIENTE
  COMPLETADO
  CANCELADO
  REEMBOLSADO
}

enum EstadoReserva {
  PENDIENTE
  CONFIRMADA
  CANCELADA
}

enum EventoEstado {
  ACTIVO
  CANCELADO
  COMPLETADO
  OCULTO
}

enum TipoImagen {
  PORTADA
  GALERIA
}

enum Role {
  ORGANIZADOR
  COLABORADOR
  USUARIO
}
