name:ManualMajorRelease-TicketeateWeb

on:
workflow_dispatch:
inputs:
version:
description:'Nuevaversiónmajor(ej:2.0.0)'
required:true
type:string
release_notes:
description:'Notasdelarelease(opcional)'
required:false
type:string

permissions:
contents:write

jobs:
major-release:
name:🚀CrearMajorRelease
runs-on:ubuntu-latest
steps:
-name:📥Checkout
uses:actions/checkout@v4
with:
fetch-depth:0
token:${{secrets.GITHUB_TOKEN}}

-name:✅Validarversión
run:|
VERSION="${{inputs.version}}"
if![["$VERSION"=~^[0-9]+\.0\.0$]];then
echo"❌Error:Laversióndebesermajor(x.0.0)"
exit1
fi
echo"✅Versiónválida:$VERSION"

-name:🔧SetupNode.js
uses:actions/setup-node@v4
with:
node-version:'22'

-name:📦Instalarpnpm
run:npminstall-gpnpm@10.10.0

-name:🔐ConfigurarGit
run:|
gitconfig--globaluser.name"github-actions[bot]"
gitconfig--globaluser.email"github-actions[bot]@users.noreply.github.com"

-name:📝Actualizarpackage.json
working-directory:apps/next-frontend
run:|
pnpmversion${{inputs.version}}--no-git-tag-version

-name:📋ActualizarCHANGELOG
working-directory:apps/next-frontend
run:|
VERSION="${{inputs.version}}"
DATE=$(date+%Y-%m-%d)

#CrearCHANGELOGsinoexiste
if[!-fCHANGELOG.md];then
echo"#Changelog">CHANGELOG.md
echo"">>CHANGELOG.md
echo"Todaslasversionesnotablesde**next-frontend**serándocumentadasenestearchivo.">>CHANGELOG.md
echo"">>CHANGELOG.md
fi

#Agregarnuevaversión
NOTES="${{inputs.release_notes}}"
if[-z"$NOTES"];then
NOTES="Majorreleaseconcambiossignificativos"
fi

#Insertardespuésdelheader
sed-i"/^#Changelog/a\\
\\
##[$VERSION]-$DATE\\
\\
###⚠️BREAKINGCHANGES\\
\\
$NOTES\\
"CHANGELOG.md

-name:💾Commitycreartag
run:|
gitaddapps/next-frontend/package.jsonapps/next-frontend/CHANGELOG.md
gitcommit-m"chore(release):next-frontendv${{inputs.version}}[skipci]

BREAKINGCHANGE:Majorreleaseconcambiossignificativos

${{inputs.release_notes}}"

gittag-a"next-frontend-v${{inputs.version}}"-m"Releasenext-frontendv${{inputs.version}}"
gitpushoriginmain--tags

-name:🎉CrearGitHubRelease
uses:actions/github-script@v7
with:
script:|
constnotes=`${{inputs.release_notes}}`||'Majorreleaseconcambiossignificativos';

awaitgithub.rest.repos.createRelease({
owner:context.repo.owner,
repo:context.repo.repo,
tag_name:'next-frontend-v${{inputs.version}}',
name:'🔴next-frontendv${{inputs.version}}',
body:`##⚠️BREAKINGCHANGES

Estaesuna**majorrelease**queincluyecambiossignificativos.

###📝Notasdelaversión

${notes}

###🔄Migración

Revisaladocumentacióndemigraciónantesdeactualizar.

---

**Fecha:**${newDate().toLocaleDateString('es-ES')}
**Tipo:**MajorRelease`,
draft:false,
prerelease:false
});

-name:✅MajorReleasecompletado
run:|
echo"🎉MajorReleasev${{inputs.version}}creadoexitosamente"
echo"📦Verificalareleaseen:https://github.com/${{github.repository}}/releases"
