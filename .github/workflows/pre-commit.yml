name:Pre-commitChecks

on:
push:
branches-ignore:
-'dependabot/**'
pull_request:
branches-ignore:
-'dependabot/**'

jobs:
pre-commit:
name:Pre-commitChecks
runs-on:ubuntu-latest

steps:
-name:Checkoutcode
uses:actions/checkout@v4
with:
fetch-depth:0

-name:SetupNode.js
uses:actions/setup-node@v4
with:
node-version:'18'

-name:Setuppnpm
uses:pnpm/action-setup@v4
with:
version:10.10.0

-name:Getpnpmstoredirectory
shell:bash
run:|
echo"STORE_PATH=$(pnpmstorepath--silent)">>$GITHUB_ENV

-name:Setuppnpmcache
uses:actions/cache@v4
with:
path:${{env.STORE_PATH}}
key:${{runner.os}}-pnpm-store-${{hashFiles('**/pnpm-lock.yaml')}}
restore-keys:|
${{runner.os}}-pnpm-store-

-name:Installdependencies
run:pnpminstall--frozen-lockfile

-name:GeneratePrismaclientandbuilddatabasepackage
env:
DATABASE_URL:"postgresql://dummy:dummy@localhost:5432/dummy"
run:|
pnpmdb:generate
pnpm--filter@repo/dbbuild

-name:Runquickchecks
run:|
echo"🔍Runningquickpre-commitchecks..."

#Checkformatting
echo"📝Checkingcodeformat..."
pnpmformat:check

#Quicklintcheck
echo"🧹Runningquicklintcheck..."
pnpmlint

#Typecheck
echo"🔍CheckingTypeScripttypes..."
pnpmcheck-types

echo"✅Allpre-commitcheckspassed!"

-name:CommentPRonfailure
if:failure()&&github.event_name=='pull_request'
uses:actions/github-script@v7
with:
script:|
github.rest.issues.createComment({
issue_number:context.issue.number,
owner:context.repo.owner,
repo:context.repo.repo,
body:'❌**Pre-commitchecksfailed!**\n\nPleasefixthefollowingissues:\n-Codeformatting(run`pnpmformat`)\n-Lintingerrors\n-TypeScripttypeerrors\n\nRun`pnpmformat:check`and`pnpmlint`locallytoseetheissues.'
})
