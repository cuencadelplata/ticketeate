# ğŸ“Š Arquitectura Visual - Alta Disponibilidad (RNF-03)

## Diagrama de Arquitectura Completo

```
                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                             â”‚         INTERNET / USUARIOS                 â”‚
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                                               â”‚ HTTP/HTTPS
                                               â”‚ Puerto 80/443
                                               â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚                                                       â”‚
                   â”‚       NGINX LOAD BALANCER (REPLICA ÃšNICA)           â”‚
                   â”‚                                                       â”‚
                   â”‚  â€¢ Algoritmo: least_conn                             â”‚
                   â”‚  â€¢ Health Checks: Pasivos (max_fails=3)             â”‚
                   â”‚  â€¢ Failover: 30s timeout                             â”‚
                   â”‚  â€¢ Retry Logic: Hasta 2 backends                     â”‚
                   â”‚  â€¢ Keepalive: 32 conexiones por upstream            â”‚
                   â”‚                                                       â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚               â”‚               â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                    â”‚    â”‚    â”‚                    â”‚
                â”‚  UPSTREAM          â”‚    â”‚    â”‚  UPSTREAM          â”‚
                â”‚  next_frontend     â”‚    â”‚    â”‚  svc_checkout      â”‚
                â”‚                    â”‚    â”‚    â”‚                    â”‚
                â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â”‚    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                       â”‚        â”‚         â”‚           â”‚        â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                                 â”‚ â”‚                             â”‚
         â–¼                                 â–¼ â–¼                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  â”‚            â”‚                  â”‚            â”‚                  â”‚
â”‚  next-frontend-1 â”‚            â”‚  next-frontend-2 â”‚            â”‚  svc-checkout-1  â”‚
â”‚                  â”‚            â”‚                  â”‚            â”‚                  â”‚
â”‚  â€¢ Puerto: 3000  â”‚            â”‚  â€¢ Puerto: 3000  â”‚            â”‚  â€¢ Puerto: 3001  â”‚
â”‚  â€¢ Health: /healthâ”‚           â”‚  â€¢ Health: /healthâ”‚           â”‚  â€¢ Health: /healthâ”‚
â”‚  â€¢ Status: UP    â”‚            â”‚  â€¢ Status: UP    â”‚            â”‚  â€¢ Status: UP    â”‚
â”‚  â€¢ CPU: 1.0      â”‚            â”‚  â€¢ CPU: 1.0      â”‚            â”‚  â€¢ CPU: 0.5      â”‚
â”‚  â€¢ Mem: 1G       â”‚            â”‚  â€¢ Mem: 1G       â”‚            â”‚  â€¢ Mem: 512M     â”‚
â”‚                  â”‚            â”‚                  â”‚            â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚               â”‚               â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                    â”‚    â”‚    â”‚                    â”‚
                â”‚  UPSTREAM          â”‚    â”‚    â”‚  UPSTREAM          â”‚
                â”‚  svc_events        â”‚    â”‚    â”‚  svc_producers     â”‚
                â”‚                    â”‚    â”‚    â”‚                    â”‚
                â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â”‚    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                       â”‚        â”‚         â”‚           â”‚        â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                                 â”‚ â”‚                             â”‚
         â–¼                                 â–¼ â–¼                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  svc-checkout-2  â”‚            â”‚  svc-events-1    â”‚            â”‚  svc-events-2    â”‚
â”‚                  â”‚            â”‚                  â”‚            â”‚                  â”‚
â”‚  â€¢ Puerto: 3001  â”‚            â”‚  â€¢ Puerto: 3002  â”‚            â”‚  â€¢ Puerto: 3002  â”‚
â”‚  â€¢ Health: /healthâ”‚           â”‚  â€¢ Health: /healthâ”‚           â”‚  â€¢ Health: /healthâ”‚
â”‚  â€¢ Status: UP    â”‚            â”‚  â€¢ Status: UP    â”‚            â”‚  â€¢ Status: UP    â”‚
â”‚  â€¢ CPU: 0.5      â”‚            â”‚  â€¢ CPU: 0.5      â”‚            â”‚  â€¢ CPU: 0.5      â”‚
â”‚  â€¢ Mem: 512M     â”‚            â”‚  â€¢ Mem: 512M     â”‚            â”‚  â€¢ Mem: 512M     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                           â”‚                               â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                    â”‚            â”‚                      â”‚
                â”‚  UPSTREAM          â”‚            â”‚  UPSTREAM            â”‚
                â”‚  svc_users         â”‚            â”‚  svc_producers       â”‚
                â”‚                    â”‚            â”‚                      â”‚
                â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                       â”‚        â”‚                        â”‚          â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                                 â”‚  â”‚                                   â”‚
         â–¼                                 â–¼  â–¼                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  svc-producers-1 â”‚            â”‚  svc-producers-2 â”‚            â”‚  svc-users-1     â”‚
â”‚                  â”‚            â”‚                  â”‚            â”‚                  â”‚
â”‚  â€¢ Puerto: 3003  â”‚            â”‚  â€¢ Puerto: 3003  â”‚            â”‚  â€¢ Puerto: 3004  â”‚
â”‚  â€¢ Health: /healthâ”‚           â”‚  â€¢ Health: /healthâ”‚           â”‚  â€¢ Health: /healthâ”‚
â”‚  â€¢ Status: UP    â”‚            â”‚  â€¢ Status: UP    â”‚            â”‚  â€¢ Status: UP    â”‚
â”‚  â€¢ CPU: 0.5      â”‚            â”‚  â€¢ CPU: 0.5      â”‚            â”‚  â€¢ CPU: 0.5      â”‚
â”‚  â€¢ Mem: 512M     â”‚            â”‚  â€¢ Mem: 512M     â”‚            â”‚  â€¢ Mem: 512M     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


                                               â”‚
                                               â”‚
                                               â–¼
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚  svc-users-2     â”‚
                                    â”‚                  â”‚
                                    â”‚  â€¢ Puerto: 3004  â”‚
                                    â”‚  â€¢ Health: /healthâ”‚
                                    â”‚  â€¢ Status: UP    â”‚
                                    â”‚  â€¢ CPU: 0.5      â”‚
                                    â”‚  â€¢ Mem: 512M     â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Flujo de Request Normal

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Usuario â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚ 1. HTTP Request
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    NGINX    â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚ 2. Selecciona rÃ©plica con least_conn
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Replica 1 (UP)  â”‚ â—„â”€â”€ Seleccionada (menos conexiones activas)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚ 3. Procesa request
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Response OK     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚ 4. Devuelve respuesta
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Usuario â”‚ â—„â”€â”€ Request exitoso (200 OK)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Tiempo total**: ~100-500ms (normal)

---

## Flujo de Failover (RÃ©plica CaÃ­da)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Usuario â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚ 1. HTTP Request
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    NGINX    â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚ 2. Intenta Replica 1
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Replica 1 (DOWN)â”‚ âœ— No responde / Timeout
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚ 3. Falla detectada
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    NGINX    â”‚ â—„â”€â”€ Marca replica como failed (contador: 1/3)
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚ 4. Retry automÃ¡tico a Replica 2
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Replica 2 (UP)  â”‚ âœ“ Responde OK
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚ 5. Procesa request
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Response OK     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚ 6. Devuelve respuesta
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Usuario â”‚ â—„â”€â”€ Request exitoso (200 OK)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Tiempo total**: ~100-700ms (con failover, transparente para el usuario)  
**Downtime percibido**: 0ms (el usuario no nota nada)

---

## Ciclo de Health Check

```
Cada 15 segundos:

NGINX Health Check (Pasivo)
â”‚
â”œâ”€â–º Replica 1: max_fails=3, fail_timeout=30s
â”‚   â”‚
â”‚   â”œâ”€â–º Si falla 1 vez: Contador = 1
â”‚   â”œâ”€â–º Si falla 2 veces: Contador = 2
â”‚   â””â”€â–º Si falla 3 veces: Marca como DOWN por 30s
â”‚
â””â”€â–º Replica 2: max_fails=3, fail_timeout=30s
    â”‚
    â””â”€â–º Misma lÃ³gica

Docker Health Check (Activo)
â”‚
â”œâ”€â–º Cada rÃ©plica ejecuta: wget http://localhost:PORT/health
â”‚   â”‚
â”‚   â”œâ”€â–º Si responde 200: Status = healthy
â”‚   â”œâ”€â–º Si falla 1-2 veces: Status = unhealthy (pero sigue corriendo)
â”‚   â””â”€â–º Si falla 3 veces: Status = unhealthy (Docker puede reiniciar)
â”‚
â””â”€â–º Start period: 20-30s (grace period al inicio)
```

---

## DistribuciÃ³n de Carga (Ejemplo)

### Escenario: 100 requests concurrentes

```
NGINX Load Balancer (least_conn)
â”‚
â”œâ”€â–º Replica 1: 52 requests â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 52%
â”‚                â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ (Alta carga)
â”‚
â””â”€â–º Replica 2: 48 requests â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 48%
                â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ (Balanceada)

Total: 100 requests
Balanceo: ~50/50 (Ã³ptimo con least_conn)
```

### Escenario: Replica 1 cae durante la carga

```
NGINX Load Balancer (failover activo)
â”‚
â”œâ”€â–º Replica 1: DOWN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 0%
â”‚                âœ—âœ—âœ—âœ— (No disponible)
â”‚
â””â”€â–º Replica 2: 100 requests â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€100%
                â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
                (Asume toda la carga, pero sigue respondiendo)

Total: 100 requests
Disponibilidad: 99%+ (algunos requests pueden fallar durante la transiciÃ³n)
```

---

## MÃ©tricas de Recursos

### Uso de CPU y Memoria

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    RESOURCE ALLOCATION                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  NGINX (1 replica)                                          â”‚
â”‚  â”œâ”€ CPU: Sin lÃ­mite                                         â”‚
â”‚  â””â”€ Mem: Sin lÃ­mite                                         â”‚
â”‚                                                             â”‚
â”‚  Next.js Frontend (2 replicas) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚  â”œâ”€ CPU: 1.0 Ã— 2 = 2.0 cores                               â”‚
â”‚  â””â”€ Mem: 1G Ã— 2 = 2 GB                                     â”‚
â”‚                                                             â”‚
â”‚  Checkout Service (2 replicas) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€       â”‚
â”‚  â”œâ”€ CPU: 0.5 Ã— 2 = 1.0 core                                â”‚
â”‚  â””â”€ Mem: 512M Ã— 2 = 1 GB                                   â”‚
â”‚                                                             â”‚
â”‚  Events Service (2 replicas) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€           â”‚
â”‚  â”œâ”€ CPU: 0.5 Ã— 2 = 1.0 core                                â”‚
â”‚  â””â”€ Mem: 512M Ã— 2 = 1 GB                                   â”‚
â”‚                                                             â”‚
â”‚  Producers Service (2 replicas) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€           â”‚
â”‚  â”œâ”€ CPU: 0.5 Ã— 2 = 1.0 core                                â”‚
â”‚  â””â”€ Mem: 512M Ã— 2 = 1 GB                                   â”‚
â”‚                                                             â”‚
â”‚  Users Service (2 replicas) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€               â”‚
â”‚  â”œâ”€ CPU: 0.5 Ã— 2 = 1.0 core                                â”‚
â”‚  â””â”€ Mem: 512M Ã— 2 = 1 GB                                   â”‚
â”‚                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  TOTAL ESTIMADO:                                            â”‚
â”‚  â”œâ”€ CPU: ~6.0 cores                                         â”‚
â”‚  â””â”€ Mem: ~7 GB                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Timeline de Eventos durante Failover

```
t=0s     Usuario hace request
         â”‚
t=0.1s   NGINX recibe request
         â”‚
t=0.2s   NGINX envÃ­a a Replica 1
         â”‚
t=0.3s   Replica 1 no responde (DOWN)
         â”‚
t=1.0s   NGINX timeout (1s)
         â”‚
t=1.1s   NGINX marca fail (contador 1/3)
         â”‚
t=1.2s   NGINX reintenta con Replica 2
         â”‚
t=1.3s   Replica 2 recibe request
         â”‚
t=1.5s   Replica 2 procesa request
         â”‚
t=1.6s   Replica 2 responde OK
         â”‚
t=1.7s   NGINX envÃ­a respuesta al usuario
         â”‚
t=1.8s   Usuario recibe respuesta (200 OK)

Total: ~1.8s (vs ~0.5s normal)
DegradaciÃ³n: ~1.3s adicional
Usuario: No percibe error (transparente)
```

---

## Red de Contenedores

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ticketeate-network                          â”‚
â”‚                  (Bridge Network)                            â”‚
â”‚                  Subnet: 172.28.0.0/16                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  nginx     â”‚  â”‚ frontend-1 â”‚  â”‚ frontend-2 â”‚           â”‚
â”‚  â”‚  :80       â”‚  â”‚ :3000      â”‚  â”‚ :3000      â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚       â”‚               â”‚               â”‚                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ checkout-1 â”‚  â”‚ checkout-2 â”‚  â”‚ events-1   â”‚           â”‚
â”‚  â”‚ :3001      â”‚  â”‚ :3001      â”‚  â”‚ :3002      â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚       â”‚               â”‚               â”‚                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ events-2   â”‚  â”‚producers-1 â”‚  â”‚producers-2 â”‚           â”‚
â”‚  â”‚ :3002      â”‚  â”‚ :3003      â”‚  â”‚ :3003      â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚       â”‚               â”‚               â”‚                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚ users-1    â”‚  â”‚ users-2    â”‚                           â”‚
â”‚  â”‚ :3004      â”‚  â”‚ :3004      â”‚                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                                                              â”‚
â”‚  ComunicaciÃ³n interna: Por nombre de contenedor            â”‚
â”‚  Aislamiento: Solo NGINX expone puerto al host (80)        â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Host Machine (Puerto 80) â”€â”€â–º NGINX â”€â”€â–º RÃ©plicas internas
```

---

## Resumen de Capacidades

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                     CAPACIDADES DE HA                        â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                              â•‘
â•‘  âœ… Balanceo de Carga              least_conn               â•‘
â•‘  âœ… Failover AutomÃ¡tico            < 5 segundos             â•‘
â•‘  âœ… Health Checks                  Cada 15s                 â•‘
â•‘  âœ… Auto-Recovery                  restart: unless-stopped  â•‘
â•‘  âœ… Zero Downtime Deployment       Rolling updates          â•‘
â•‘  âœ… Resource Limits                CPU + Memory             â•‘
â•‘  âœ… Network Isolation              Bridge network           â•‘
â•‘  âœ… Monitoring Endpoints           /health, /health/status  â•‘
â•‘  âœ… Retry Logic                    Hasta 2 backends         â•‘
â•‘  âœ… Connection Pooling             32 keepalive conexiones  â•‘
â•‘                                                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

**Ãšltima actualizaciÃ³n**: 31 de octubre de 2025  
**Proyecto**: Ticketeate  
**Requerimiento**: RNF-03 - Alta Disponibilidad
